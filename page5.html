<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Pedidos</title>
</head>
<body>
    <header class="titulo">
        <button class="button_voltar"><img src="imgs/voltar.svg"></button>
        <h1 class="shadow">Perfil</h1>
        <h2>Bem vindo(a) <h2 id="nome"></h2></h2>
    </header>
    <!-- <img class="img_perfil" src="imgs/perfil.png" height="175px"> -->
    
    <input type="file" name="meu_upload" id="meu_upload">
    <div class="img_perfil">
        <img id="imagem" src="imgs/perfil.png" height="175px" width="175px">
        <img id="imagemSelect" src="frame2.png" class="img_perfil_edit" height="175px" width="175px">
    </div>
    </input>
    

    <main class="caixa_perfil">
        <a class="caixas_perfil">
            <img src="imgs/settings.svg">
            <h1>Informações</h1>
            <img src="imgs/setinha3.svg" class="setinha_perfil">
        </a>
        <a class="caixas_perfil">
            <img src="imgs/notify.svg">
            <h1>Notificações</h1>
            <img src="imgs/setinha3.svg" class="setinha_perfil">
        </a>
        <a class="caixas_perfil">
            <img src="imgs/cupons.svg">
            <h1>Cupons</h1>
            <img src="imgs/setinha3.svg" class="setinha_perfil">
        </a>
        <a class="caixas_perfil">
            <img src="imgs/wallet.svg">
            <h1>Carteira</h1>
            <img src="imgs/setinha3.svg" class="setinha_perfil">
        </a>
        <a href="page1.html" class="logout_perfil">
            <img src="imgs/logout2.svg">
            <h1>Logout</h1>
        </a>
    </main>
    <footer class="menu_bar">
        <button class="menu_button" onclick="abrirPage(1)"><img src="imgs/Home.svg" class="menu_img"></button>
        <button class="menu_button" onclick="abrirPage(2)"><img src="imgs/Search.svg" class="menu_img"></button>
        <button class="menu_button" onclick="abrirPage(3)"><img src="imgs/Cart.svg" class="menu_img"></button>
        <button class="menu_button" onclick="abrirPage(4)"><img src="imgs/Profile.svg" class="menu_img"></button>
    </footer>
</body>

<script src="jquery-3.6.0.min.js"></script>
<script>
   
    /* --------------- DataBase --------------- */
    
    var db = openDatabase('APP','v1.0','Minha base',2*1024*1024)

    var variaveis = new URLSearchParams(location.search);
    var usuario = variaveis.get('usuario');
    nome.innerHTML=usuario;


    $('#imagemSelect').click(function(){
        $('#meu_upload').click();
    });

    $(document).on("change", "#meu_upload", function(e) {
        showThumbnail(this.files);
    });

    function showThumbnail(files) {
        if (files && files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
               imagem.src =  e.target.result;


               db.transaction(function(tx)
                {
                    tx.executeSql('UPDATE users SET imagem=? WHERE login=?',[imagem.src,usuario]);
                })
            }

            reader.readAsDataURL(files[0]);
        }
    }

    db.transaction(function(tx)
        {
            var consulta = 'SELECT * FROM users WHERE login=?';
            tx.executeSql(consulta,[usuario], function(tx,resultados)
            {   
                // Pegando o número de linhas retornado:
                var linhas = resultados.rows.length;
                // Percorrendo cada linha:
                for(i=0; i<linhas; i++)
                {
                    // Vamos pegar o peso:
                    imagem.src = resultados.rows.item(i).imagem;
                }
            });
        })

    function abrirPage(x){
        if (x == 1){
            window.open("page2.html?usuario="+usuario,"_self");
        }
        if (x == 2){
            window.open("page3.html?usuario="+usuario,"_self");
        }
        if (x == 3){
            window.open("page4.html?usuario="+usuario,"_self");
        }
        if (x == 4){
            window.open("page5.html?usuario="+usuario,"_self");
        }
    }
</script>
</html>